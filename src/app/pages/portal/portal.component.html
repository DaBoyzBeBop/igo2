<mat-sidenav-container class="igo-main-container">

  <igo-backdrop
    [shown]="backdropShown"
    (click)="onBackdropClick()">
  </igo-backdrop>

  <button
    mat-icon-button
    id="menu-button"
    class="menu-button"
    color="primary"
    tooltip-position="below"
    matTooltipShowDelay="500"
    [matTooltip]="(sidenavOpened ? 'menu.close' : 'menu.open') | translate"
    (click)="onToggleSidenavClick()">
    <mat-icon>
      <ng-container>menu</ng-container>
    </mat-icon>
  </button>

  <igo-search-bar
    [minLength]="minSearchTermLength"
    (change)="onSearchTermChange($event)"
    (search)="onSearch($event)">
  </igo-search-bar>

  <igo-sidenav
    [ngClass]="{'igo-sidenav-with-expansion-panel': expansionPanelExpanded}"
    [(opened)]="sidenavOpened">
  </igo-sidenav>

  <igo-map-browser
    igoQuery
    [waitForAllQueries]="true"
    igoMapContext
    igoLayerContext
    igoDropGeoFile
    (query)="onMapQuery($event)"
    [map]="map">
    <!-- [ngClass]="{'igo-attribution-offset': map.getBaseLayers().length > 1}"
    [@mapStateX]="sidenavOpened ? 'right' : 'left'"
    (@mapStateX.start)="removeMapBrowserClass($event)"
    (@mapStateX.done)="updateMapBrowserClass($event)"
    [@mapStateY]="toastShown ? (toastPanelOpened ? 'up' : 'down') : 'close'"
    (@mapStateY.start)="removeMapBrowserClass($event)"
    (@mapStateY.done)="updateMapBrowserClass($event)" -->

    <!-- <igo-zoom-button [map]="map" color="primary"></igo-zoom-button>
    <igo-geolocate-button [map]="map" color="primary"
      [@controlStateY]="toastShown ? (toastPanelOpened ? 'up' : 'down') : 'close'">
    </igo-geolocate-button>
    <igo-rotation-button [map]="map" color="primary"></igo-rotation-button>
    <igo-user-button [map]="map" color="primary"
      [@controlStateY]="toastShown ? (toastPanelOpened ? 'up' : 'down') : 'close'">
    </igo-user-button>
    <igo-baselayers-switcher [map]="map"
      [@controlStateY]="toastShown ? (toastPanelOpened ? 'up' : 'down') : 'close'"
      [@controlStateX]="(mediaService.media$ | async) !== 'mobile' &&
                              sidenavOpened ? 'right' : 'left'">
    </igo-baselayers-switcher> -->
    <igo-baselayers-switcher [map]="map"></igo-baselayers-switcher>
  </igo-map-browser>

  <igo-expansion-panel
    [(expanded)]="expansionPanelExpanded"
    [backdropShown]="expansionPanelBackdropShown">

    <ng-container expansionPanelHeader>
      <igo-editor-selector igoWfsEditorSelector [store]="editorStore" [map]="map"></igo-editor-selector>
      <igo-actionbar
        *ngIf="editor"
        [store]="editor.actionStore"
        [horizontal]="true"
        [xPosition]="'after'"
        [yPosition]="'above'"
        [withToggleButton]="true"
        [withTitle]="actionbarWithTitle"
        [mode]="actionbarMode">
      </igo-actionbar>
    </ng-container>

    <igo-entity-table
      *ngIf="editor"
      class="table-compact table-centered"
      [store]="editor.entityStore"
      [template]="editor.tableTemplate">
    </igo-entity-table>

  </igo-expansion-panel>

</mat-sidenav-container>

<igo-toast-panel
  [title]="toastPanelTitle"
  [withHeader]="toastPanelContent === 'feature'"
  [(opened)]="toastPanelOpened">

  <igo-feature-details
    *ngIf="toastPanelContent === 'feature'"
    [feature]="searchResult.data">
  </igo-feature-details>

  <igo-editor-outlet
    *ngIf="toastPanelContent === 'editor'"
    [editor]="editor"
    (deactivateWidget)="onDeactivateEditorWidget()">
  </igo-editor-outlet>

</igo-toast-panel>

  <!-- <igo-toast
    [map]="map"
    [expanded]="toastOpened"
    [feature]="featureService.focusedFeature$ | async"
    (onOpened)="toastOpened=$event"
    (swipeleft)="swipe($event.type)"
    (swiperight)="swipe($event.type)"
    *ngIf="toastShown">
  </igo-toast> -->
